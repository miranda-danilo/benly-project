<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Text to Speech M贸vil</title>
</head>
<body style="display: flex; background-color: plum; justify-content: center; align-items: center; height: 100vh; flex-direction: column; font-family: Arial, sans-serif; gap: 1rem;">
<h2>Hola Amber </h2>
<p style="font-weight: bold; font-size: 1.2rem;">Bienvenida!</p>
<img src="https://cdn.prod.website-files.com/5fdb2fcbe8cb905cd95d758f/6780aa0e17a09012b62ee2f4_Karla%20Bustillos.png" alt="" width="200" height="200" loading="lazy" style="border-radius: 50%;">

<input style="background-color: aliceblue; padding: 0.4rem 0.8rem; width: 40%;" type="text" id="textInput" placeholder="Escribe algo en ingl茅s" >
<select style="padding: 1rem;" id="voiceSelect"></select>
<button style="padding: 0.4rem 0.8rem; background-color: rgb(255, 98, 124); color: white; font-size: 1.25rem; font-style: italic; font-weight: bold; " id="testVoice"> Probar voz</button>

<script>
let voicesLoaded = false;

// ============================================================
// Funci贸n para cargar voces disponibles
// ============================================================
async function loadVoicesWithFallback() {
    return new Promise(resolve => {
        let voices = speechSynthesis.getVoices();

        if (voices.length) return resolve(voices);

        // Forzar una s铆ntesis m铆nima para despertar el motor
        const dummyUtterance = new SpeechSynthesisUtterance(" ");
        speechSynthesis.speak(dummyUtterance);

        speechSynthesis.onvoiceschanged = () => {
            voices = speechSynthesis.getVoices();
            resolve(voices);
        };

        // Timeout de seguridad en caso de que onvoiceschanged no se dispare
        setTimeout(() => {
            voices = speechSynthesis.getVoices();
            resolve(voices);
        }, 2000);
    });
}


// ============================================================
// Llenar el selector con voces EN-US
// ============================================================
async function populateVoiceSelector() {
    const select = document.getElementById("voiceSelect");
    select.innerHTML = ''; // Limpiar opciones previas

    const voices = await loadVoices();
    const usVoices = voices.filter(v => v.lang.startsWith("en-US"));

    usVoices.forEach((voice, index) => {
        const option = document.createElement("option");
        option.value = voice.name;
        option.textContent = `${index + 1}. ${voice.name}`;
        select.appendChild(option);
    });

    if (usVoices.length > 0) select.value = usVoices[0].name;

    console.log("Voces EN-US cargadas:", usVoices.map(v => v.name));
}

// ============================================================
// Funci贸n para reproducir texto con voz seleccionada
// ============================================================
async function speakWithSelectedVoice() {
    if (!voicesLoaded) await populateVoiceSelector();

    const select = document.getElementById("voiceSelect");
    const textInput = document.getElementById("textInput");
    const text = textInput.value.trim() || "Hello, this is a test of the speech synthesis feature.";

    const voices = speechSynthesis.getVoices();
    const selectedVoice = voices.find(v => v.name === select.value);

    if (!selectedVoice) {
        alert("La voz seleccionada no est谩 disponible. Intenta otra.");
        return;
    }

    const utterance = new SpeechSynthesisUtterance(text);
    utterance.voice = selectedVoice;
    utterance.rate = 1;
    utterance.pitch = 1;
    utterance.volume = 1;

    // Cancelar cualquier reproducci贸n previa
    speechSynthesis.cancel();
    speechSynthesis.speak(utterance);

    console.log("Reproduciendo voz:", selectedVoice.name);
}

// ============================================================
// Evento de bot贸n
// ============================================================
document.getElementById("testVoice").addEventListener("click", speakWithSelectedVoice);

// Inicializar selector al cargar p谩gina
populateVoiceSelector();
</script>
</body>
</html>
