<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Text to Speech Ingl√©s</title>
</head>
<body style="display: flex; background-color: plum; justify-content: center; align-items: center; height: 100vh; flex-direction: column; font-family: Arial, sans-serif; gap: 1rem;">

<h2>Hola Amber üòÅ</h2>
<p style="font-weight: bold; font-size: 1.2rem;">Bienvenida!</p>

<input style="background-color: aliceblue; padding: 0.4rem 0.8rem; width: 40%;" type="text" id="textInput" placeholder="Escribe algo en ingl√©s" >
<select style="padding: 1rem;" id="voiceSelect"></select>
<button style="padding: 0.4rem 0.8rem; background-color: rgb(255, 98, 124); color: white; font-size: 1.25rem; font-style: italic; font-weight: bold;" id="testVoice">üîä Probar voz</button>

<script>
let voicesLoaded = false;

// ============================================================
// Cargar voces disponibles (wake-up para m√≥viles)
// ============================================================
async function loadVoicesWithFallback() {
    return new Promise(resolve => {
        let voices = speechSynthesis.getVoices();
        if (voices.length) {
            voicesLoaded = true;
            return resolve(voices);
        }

        // Forzar wake-up del motor
        const dummy = new SpeechSynthesisUtterance(" ");
        speechSynthesis.speak(dummy);

        speechSynthesis.onvoiceschanged = () => {
            voices = speechSynthesis.getVoices();
            voicesLoaded = true;
            resolve(voices);
        };

        // Timeout de seguridad
        setTimeout(() => {
            voices = speechSynthesis.getVoices();
            voicesLoaded = true;
            resolve(voices);
        }, 2000);
    });
}

// ============================================================
// Llenar selector con todas las voces en ingl√©s (en*)
// ============================================================
async function populateVoiceSelector() {
    const select = document.getElementById("voiceSelect");
    select.innerHTML = '';

    const voices = await loadVoicesWithFallback();
    const englishVoices = voices.filter(v => v.lang.startsWith("en")); // todas las voces en ingl√©s

    englishVoices.forEach((voice, index) => {
        const option = document.createElement("option");
        option.value = voice.name; 
        option.textContent = `${index + 1}. ${voice.name} (${voice.lang})`;
        select.appendChild(option);
    });

    // Seleccionar autom√°ticamente la primera voz
    if (englishVoices.length > 0) select.value = englishVoices[0].name;

    console.log("Voces ingles cargadas:", englishVoices.map(v => `${v.name} (${v.lang})`));
}

// ============================================================
// Reproducir texto con voz seleccionada
// ============================================================
async function speakWithSelectedVoice() {
    if (!voicesLoaded) await populateVoiceSelector();

    const select = document.getElementById("voiceSelect");
    const textInput = document.getElementById("textInput");
    const text = textInput.value.trim() || "Hello, this is a test.";

    const voices = speechSynthesis.getVoices();
    const selectedVoice = voices.find(v => v.name === select.value);

    if (!selectedVoice) {
        alert("La voz seleccionada no est√° disponible. Intenta otra.");
        return;
    }

    const utterance = new SpeechSynthesisUtterance(text);
    utterance.voice = selectedVoice;
    utterance.rate = 1;   // puedes ajustar
    utterance.pitch = 1;  // puedes ajustar
    utterance.volume = 1;

    speechSynthesis.cancel();
    speechSynthesis.speak(utterance);

    console.log("Reproduciendo voz:", selectedVoice.name, selectedVoice.lang);
}

// ============================================================
// Evento bot√≥n
// ============================================================
document.getElementById("testVoice").addEventListener("click", speakWithSelectedVoice);

// Inicializar selector al cargar p√°gina
populateVoiceSelector();
</script>
</body>
</html>
